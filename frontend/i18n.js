const translations = {
    en: {
        "title-index": "Select Your Fruit - Pass Apple",
        "title-apple": "Sleek Sketch - White on Black",
        "about-app": "About this app",
        "select-fruit": "Select a Fruit",
        "choose-canvas": "Choose your canvas to start drawing",
        "fruit-apple": "Apple",
        "fruit-maron": "Maron",
        "fruit-radish": "Radish",
        "fruit-watermelon": "Watermelon",
        "brush-size": "Size",
        "undo": "Undo",
        "redo": "Redo",
        "clear": "Clear",
        "save": "Save",
        "back": "Back",
        "pen": "Pen",
        "eraser": "Eraser",
        "text": "Text",
        "prompt-text": "Enter text to draw:",
        "coming-soon": "Coming Soon",
        "hint": "Draw with finger or mouse",
        "processing": "Processing Image...",
        "result-title": "Processed Result",
        "download": "Download Result",
        "share-prompt": "Share on SNS with hashtag #PassAppleApp!",
        "share-x": "Post to X",
        "saving": "Saving...",
        "app-name": "PassAppleApp",
        "error-no-path": "Saved to server successfully, but no return path found!",
        "error-save": "Error saving to server.",
        "lang-en": "EN",
        "lang-ja": "JA",
        "about-header-1": "What is Pass Apple?",
        "about-desc-1": "\"Success Apple\" (Goukaku Ringo) is a popular good-luck charm for students. It is created by applying lettering tape to apples before they turn red, so that when they ripen, only the covered parts stay yellow. With this tool, anyone can easily create a wallpaper in the style of these \"Success Apples.\" We also plan to expand this concept to other fruits and vegetables! Please look forward to it.",
        "about-header-2": "How to use",
        "about-desc-2": "1. Select a fruit from the gallery. 2. Draw your design with white ink on the black canvas. 3. Click \"Save\" to process and download your final creation."
    },
    ja: {
        "title-index": "フルーツを選択 - パスアップル",
        "title-apple": "お絵描き - 黒背景に白",
        "about-app": "このアプリについて",
        "select-fruit": "フルーツを選択",
        "choose-canvas": "キャンバスを選んで描画を開始しましょう",
        "fruit-apple": "りんご",
        "fruit-maron": "くり",
        "fruit-radish": "ラディッシュ",
        "fruit-watermelon": "すいか",
        "brush-size": "サイズ",
        "undo": "元に戻す",
        "redo": "やり直し",
        "clear": "全消去",
        "save": "保存",
        "back": "戻る",
        "pen": "ペン",
        "eraser": "消しゴム",
        "text": "テキスト",
        "prompt-text": "描画する文字を入力してください:",
        "coming-soon": "準備中",
        "hint": "指やマウスで描いてください",
        "processing": "画像を処理中...",
        "result-title": "処理結果",
        "download": "結果をダウンロード",
        "share-prompt": "ハッシュタグ #PassAppleApp をつけて、SNSに共有してね！",
        "share-x": "Xに投稿する",
        "saving": "保存中...",
        "app-name": "合格林檎",
        "error-no-path": "サーバーに保存されましたが、返却パスが見つかりませんでした！",
        "error-save": "サーバーへの保存中にエラーが発生しました。",
        "lang-en": "英語",
        "lang-ja": "日本語",
        "about-header-1": "Pass Appleとは？",
        "about-desc-1": "受験のゲン担ぎとして人気の「合格林檎」。 赤く色づく前のりんごに文字テープを貼り、熟した際にその部分だけが黄色く残る仕組みを利用したものです。 このツールを使えば、そんな「合格林檎」風の待ち受け画像を、誰でも簡単に作成できます。また、この仕組みを生かして他のフルーツや野菜にも展開予定！楽しみに待っていてください。",
        "about-header-2": "使い方",
        "about-desc-2": "1. ギャラリーから好きなフルーツを選択します。 2. 黒い画面に白い線で自由に描きます。 3. 「保存」をクリックすると画像が処理され、結果をダウンロードできます。"
    },
    zh: {
        "title-index": "选择水果 - Pass Apple",
        "title-apple": "绘图 - 黑底白画",
        "about-app": "关于此应用",
        "select-fruit": "选择水果",
        "choose-canvas": "选择画布开始绘图",
        "fruit-apple": "苹果",
        "fruit-maron": "板栗",
        "fruit-radish": "萝卜",
        "fruit-watermelon": "西瓜",
        "brush-size": "笔触大小",
        "undo": "撤销",
        "redo": "重做",
        "clear": "清除",
        "save": "保存",
        "back": "返回",
        "pen": "笔",
        "eraser": "橡皮擦",
        "text": "文本",
        "prompt-text": "输入要绘制的文本:",
        "coming-soon": "敬请期待",
        "hint": "用手指或鼠标绘图",
        "processing": "正在处理图像...",
        "result-title": "处理结果",
        "download": "下载结果",
        "saving": "正在保存...",
        "app-name": "合格苹果",
        "error-no-path": "保存成功，但未找到返回路径！",
        "error-save": "保存到服务器时出错。",
        "lang-en": "英文",
        "lang-ja": "日文",
        "lang-zh": "中文",
        "lang-ko": "韩文",
        "about-header-1": "什么是 Pass Apple？",
        "about-desc-1": "“合格苹果”（Goukaku Ringo）是考生中非常受欢迎的吉祥物。它的制作原理是在苹果变红之前贴上文字胶带，熟透后被遮盖的部分会保持黄色。通过这个工具，任何人都可以轻松制作出“合格苹果”风格的手机壁紙。此外，我们也计划将这一机制应用到其他水果和蔬菜中！敬请期待。",
        "about-header-2": "如何使用",
        "about-desc-2": "1. 从画廊中选择一种水果。 2. 在黑色画布上用白色线条绘图。 3. 点击“保存”以处理并下载您的作品。"
    },
    ko: {
        "title-index": "과일 선택 - Pass Apple",
        "title-apple": "드로잉 - 검은 배경에 흰색",
        "about-app": "앱 정보",
        "select-fruit": "과일 선택",
        "choose-canvas": "캔버스를 선택하여 드로잉 시작",
        "fruit-apple": "사과",
        "fruit-maron": "밤",
        "fruit-radish": "래디시",
        "fruit-watermelon": "수박",
        "brush-size": "크기",
        "undo": "실행 취소",
        "redo": "다시 실행",
        "clear": "지우기",
        "save": "저장",
        "back": "뒤로",
        "pen": "펜",
        "eraser": "지우개",
        "text": "텍스트",
        "prompt-text": "그릴 텍스트를 입력하세요:",
        "coming-soon": "준비 중",
        "hint": "손가락이나 마우스로 그리세요",
        "processing": "이미지 처리 중...",
        "result-title": "처리 결과",
        "download": "결과 다운로드",
        "saving": "저장 중...",
        "app-name": "합격사과",
        "error-no-path": "서버 저장 완료, 결과 경로를 찾을 수 없습니다!",
        "error-save": "서버 저장 중 오류 발생.",
        "lang-en": "영어",
        "lang-ja": "일본어",
        "lang-zh": "중국어",
        "lang-ko": "한국어",
        "about-header-1": "Pass Apple이란 무엇입니까?",
        "about-desc-1": "수험생들 사이에서 행운의 상징으로 인기 있는 '합격 사과(고카쿠 링고)'. 사과가 빨갛게 익기 전에 글자 테이프를 붙여, 익었을 때 그 부분만 노란색으로 남게 하는 원리를 이용한 것입니다. 이 툴을 사용하면 누구나 쉽게 '합격 사과' 스타일의 배경화면 이미지를 만들 수 있습니다. 또한, 이 방식을 활용해 다른 과일이나 채소로도 확장할 예정이니 기대해 주세요!",
        "about-header-2": "사용 방법",
        "about-desc-2": "1. 갤러리에서 과일을 선택합니다. 2. 검은색 캔버스 위에 흰색 선으로 그림을 그립니다. 3. '저장'을 클릭하여 이미지를 처리하고 다운로드합니다."
    },
    itl: {
        "title-index": "Фрукт к'алӽалч - Pass Apple",
        "title-apple": "К'иԓч - Pass Apple",
        "about-app": "Апп информацияӽ",
        "select-fruit": "Фрукт к'алӽалч",
        "choose-canvas": "К'иԓчӽэл к'алӽалч",
        "fruit-apple": "Я'влоӄо",
        "fruit-maron": "栗",
        "fruit-radish": "Ладиш",
        "fruit-watermelon": "Арвуз",
        "brush-size": "Размер",
        "undo": "Х'алчаш",
        "redo": "Мԓэсчэн",
        "clear": "Чисткаӽ",
        "save": "К'оԓч",
        "back": "К'энаӽ",
        "pen": "К'иԓч",
        "eraser": "Чисткаӽ",
        "text": "К'оԓч к'иԓч",
        "prompt-text": "К'иԓч к'оԓч:",
        "coming-soon": "Танӽ...",
        "hint": "К'иԓч к'оԓч",
        "processing": "Обработкаӽ...",
        "result-title": "Результат",
        "download": "Скачать",
        "saving": "К'оԓч...",
        "app-name": "Итэнмэн Apple",
        "error-no-path": "Ошибкаӽ",
        "error-save": "Ошибкаӽ к'оԓч",
        "lang-en": "English",
        "lang-ja": "日本語",
        "lang-zh": "中文",
        "lang-ko": "한국어",
        "lang-itl": "Итэнмэн",
        "about-header-1": "Pass Apple х'энаӽ?",
        "about-desc-1": "Pass Apple к'иԓч апп. Фрукт к'алӽалч к'иԓч.",
        "about-header-2": "К'оԓч",
        "about-desc-2": "1. Фрукт к'алӽалч. 2. К'иԓч. 3. К'оԓч Результат."
    }
};

let currentLang = localStorage.getItem('language') || (navigator.language.startsWith('ja') ? 'ja' : 'en');

function t(key) {
    return translations[currentLang][key] || key;
}

function updateContent() {
    document.querySelectorAll('[data-i18n], [data-i18n-title]').forEach(el => {
        const key = el.getAttribute('data-i18n');
        const titleKey = el.getAttribute('data-i18n-title');

        if (key) {
            const translation = t(key);
            if (el.tagName === 'INPUT' && (el.type === 'button' || el.type === 'submit')) {
                el.value = translation;
            } else if (el.tagName === 'IMG') {
                el.alt = translation;
            } else if (el.hasAttribute('data-i18n-no-text')) {
                // Do nothing to textContent
            } else {
                el.textContent = translation;
            }
        }

        if (titleKey) {
            el.title = t(titleKey);
        }
    });

    // Update document title if applicable
    if (document.body.dataset.pageTitle) {
        document.title = t(document.body.dataset.pageTitle);
    }
}

function setLanguage(lang) {
    currentLang = lang;
    localStorage.setItem('language', lang);
    updateContent();
}

function initI18n() {
    updateContent();
}

// Export for main.js to use
window.i18n = {
    t,
    setLanguage,
    currentLang: () => currentLang
};

document.addEventListener('DOMContentLoaded', initI18n);
